# -----------------------------
# PostgreSQL configuration file
# OTIMIZADO PARA ISP MONITOR (TURBO EDITION)
# -----------------------------
# 
# Alterações v2:
# - Synchronous Commit OFF (Velocidade Extrema)
# - Locales Automaticos (Compatibilidade Windows Universal)
#

#------------------------------------------------------------------------------
# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------

shared_buffers = 2GB			# 25% da RAM
work_mem = 16MB				# Otimizado para conexões simultaneas
maintenance_work_mem = 512MB		# Acelera VACUUM e CREATE INDEX

dynamic_shared_memory_type = windows

#------------------------------------------------------------------------------
# I/O & PERFORMANCE (SSD)
#------------------------------------------------------------------------------

effective_io_concurrency = 200		# SSD Optimization
random_page_cost = 1.1			# SSD Cost Model

# --- TURBO MODE ---
# Aumenta drasticamente a velocidade de logs e inserts.
# Em caso de crash DO SO (tela azul/falta de luz), pode-se perder 
# uma fração de segundo de dados. Aceitável para monitoramento.
synchronous_commit = off  

#------------------------------------------------------------------------------
# WRITE-AHEAD LOG
#------------------------------------------------------------------------------

wal_buffers = 16MB
checkpoint_completion_target = 0.9
max_wal_size = 4GB
min_wal_size = 1GB

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

effective_cache_size = 6GB		# Estima cache do SO disponível
default_statistics_target = 100

#------------------------------------------------------------------------------
# CONEXOES E REDE
#------------------------------------------------------------------------------

listen_addresses = '*'
port = 5432
max_connections = 100

#------------------------------------------------------------------------------
# LOGGING (Reduzido para economia de disco)
#------------------------------------------------------------------------------

log_destination = 'stderr'
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
# log_min_duration_statement = 1000  # Logar queries lentas (>1s) se precisar debug

#------------------------------------------------------------------------------
# AUTOTVACCUM (Manutenção Automática Agressiva)
#------------------------------------------------------------------------------

autovacuum = on
autovacuum_max_workers = 4
autovacuum_naptime = 1min
autovacuum_vacuum_scale_factor = 0.05	# Limpa tabelas com 5% de lixo (antes era 20%)
autovacuum_analyze_scale_factor = 0.02
autovacuum_vacuum_cost_delay = 2ms
autovacuum_work_mem = 256MB

#------------------------------------------------------------------------------
# LOCALE & FORMATACAO
#------------------------------------------------------------------------------
# Comentados para usar o padrao detectado pelo initdb (Evita erros de startup)
# datestyle = 'iso, dmy'
# timezone = 'America/Sao_Paulo'
# lc_messages = ... (USAR PADRAO DO SISTEMA)
